---

# ==============================================================================
#  Check if os is supported by role
# ==============================================================================

- include: assert_os.yml

# ==============================================================================
#  Include variables based on operating system
# ==============================================================================

- include_vars: default.yml

# ==============================================================================
#  Install only if requested version doesn't already exist
# ==============================================================================

#- include: assert_installed.yml

- name: Vault | check if version already installed
  stat:
    path: "{{ os_dir_packages }}/vault/{{ vault_version }}"
  register: version_exists

- block:
  - include: download.yml
  - include: user.yml
  - include: folders.yml
  - include: install.yml
  when: not version_exists['stat']['exists']

# ==============================================================================
#  Configure service
# ==============================================================================

- include: configure.yml
- include: initialize.yml
